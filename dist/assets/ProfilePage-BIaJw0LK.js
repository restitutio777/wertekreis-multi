import{c as Q,u as _,j as e,i as Z,d as E,s as A,a as se,g as R,M as Ne,U as te,C as re,b as ye,p as T,e as we,r as ke}from"./index-UPCPm7Xb.js";import{r as l}from"./vendor-Cu3A5fdw.js";import{A as _e,i as Ce}from"./categories-C1PraM_-.js";import{a as X,f as ne}from"./dateFormatting-DVUp9hjQ.js";import{H as V}from"./heart-DcPyuDa1.js";import{X as I,L as B,S as Se}from"./x-BytK9WAV.js";import{C as ae,H as oe}from"./home-CzafomOg.js";import{A as H}from"./alert-circle-Dl6xFNS-.js";import{M as W}from"./message-circle-DvJnhOR9.js";import{A as ze}from"./arrow-left-l6isnbXA.js";import{C as Y,T as Ee}from"./trash-2-CQKD2b4n.js";import"./supabase-DM9F-q20.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Q("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Q("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=Q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),qe=[{value:"Silent Walk",key:"connection.proposals.silentWalk",icon:"🚶‍♀️"},{value:"Tea & Soul Talk",key:"connection.proposals.teaTalk",icon:"🍵"},{value:"Book Circle",key:"connection.proposals.bookCircle",icon:"📚"},{value:"Just Connect",key:"connection.proposals.justConnect",icon:"💫"}];function Me({receiverProfileId:t,receiverName:n,currentUserId:c,onClose:o,onSendSuccess:a}){const{t:s}=_(),[u,r]=l.useState(""),[x,m]=l.useState(""),[P,q]=l.useState(!1),[N,y]=l.useState(null),[b,k]=l.useState(null);l.useEffect(()=>{(async()=>{try{const{data:w,error:S}=await E.checkExistingRequest(c,t);!S&&w&&k(w)}catch(w){console.error("Error checking existing request:",w)}})()},[c,t]),l.useEffect(()=>{if(N){const j=setTimeout(()=>y(null),5e3);return()=>clearTimeout(j)}},[N]);const L=async j=>{if(j.preventDefault(),!u){y({type:"error",text:"Bitte wähle einen Vorschlag aus."});return}q(!0),y(null);try{const{data:w,error:S}=await E.sendRequest(c,t,u,x.trim()||void 0);S?(console.error("Error sending request:",S),S.code==="23505"?y({type:"error",text:"Du hast bereits eine Anfrage an diese Person gesendet."}):y({type:"error",text:`Fehler beim Senden: ${S.message}`})):(y({type:"success",text:"Kontaktanfrage erfolgreich gesendet!"}),setTimeout(()=>{a(),o()},1500))}catch(w){console.error("Error sending request:",w),y({type:"error",text:"Unerwarteter Fehler beim Senden der Anfrage."})}finally{q(!1)}};return b?(b.sender_id,e.jsxs("div",{className:"fixed inset-0 bg-deep-charcoal/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:[" ",e.jsxs("div",{className:"bg-silver-100 rounded-xl max-w-md w-full shadow-2xl",children:[" ",e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-stone-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{size:20,className:"text-burnt-sienna"})," "]}),e.jsxs("button",{onClick:o,className:"p-2 hover:bg-stone-100 rounded-lg transition-colors duration-200",children:[e.jsx(I,{size:20,className:"text-silver-700"})," "]})]}),e.jsxs("div",{className:"p-6 text-center space-y-4",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full ${b.status==="accepted"?"bg-deep-sage-green/10":b.status==="pending"?"bg-muted-gold/10":"bg-burnt-sienna/10"}`,children:b.status==="accepted"?"✅":b.status==="pending"?"⏳":"❌"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-silver-500",children:[" ","Vorschlag: ",b.proposal_type]}),b.message&&e.jsxs("p",{className:"text-sm text-silver-500 mt-2 italic",children:[" ",'"',b.message,'"']})]}),e.jsx("button",{onClick:o,className:"w-full bg-burnt-sienna text-pure-white py-3 px-6 rounded-lg font-medium hover:bg-burnt-sienna/80 transition-colors duration-200",children:s("common.understood")})]})]})]})):e.jsx("div",{className:"fixed inset-0 bg-charcoal/80 backdrop-blur-md z-50 flex items-center justify-center p-4 pb-24",children:e.jsxs("div",{className:"bg-silver-100 rounded-xl max-w-md w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[" ",e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-stone-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{size:20,className:"text-burnt-sienna"})," ",e.jsx("h3",{className:"font-medium font-logo text-rhino",children:s("connection.sendRequest")})]}),e.jsxs("button",{onClick:o,className:"p-2 hover:bg-stone-100 rounded-lg transition-colors duration-200",children:[e.jsx(I,{size:20,className:"text-silver-700"})," "]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)] bg-white",children:[N&&e.jsxs("div",{className:`rounded-lg p-4 flex items-center space-x-3 mb-6 ${N.type==="success"?"bg-deep-sage-green/10 text-deep-sage-green border border-deep-sage-green/20":N.type==="error"?"bg-burnt-sienna/10 text-burnt-sienna border border-burnt-sienna/20":"bg-vibrant-teal/10 text-vibrant-teal border border-vibrant-teal/20"}`,children:[N.type==="success"&&e.jsx(ae,{size:20,className:"text-deep-sage-green"})," ",N.type==="error"&&e.jsx(H,{size:20,className:"text-burnt-sienna"})," ",N.type==="info"&&e.jsx(H,{size:20,className:"text-vibrant-teal"})," ",e.jsx("span",{className:"text-sm font-medium text-deep-charcoal",children:N.text})," "]}),e.jsxs("form",{id:"connect-request-form",onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-silver-500",children:[" ",s("connection.contactQuestion",{name:n})]}),e.jsxs("p",{className:"text-sm text-silver-500 mt-1",children:[" ",s("connection.selectProposalAndMessage")]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-stone-700 mb-3",children:[s("connection.proposalType")," *"]}),e.jsx("div",{className:"space-y-3",children:qe.map(j=>e.jsxs("label",{className:`flex items-start space-x-3 p-4 border rounded-lg cursor-pointer transition-all duration-200 ${u===j.value?"border-burnt-sienna/40 bg-burnt-sienna/10":"border-silver-200 hover:border-burnt-sienna/20 hover:bg-burnt-sienna/5"}`,children:[e.jsx("input",{type:"radio",name:"proposal",value:j.value,checked:u===j.value,onChange:w=>r(w.target.value),className:"mt-1 w-4 h-4 text-burnt-sienna border-silver-200 focus:ring-burnt-sienna"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-deep-charcoal",children:[" ",e.jsx("span",{className:"text-lg",children:j.icon}),e.jsx("span",{className:"font-medium",children:s(`${j.key}.title`)})]}),e.jsx("p",{className:"text-sm text-silver-500 mt-1",children:s(`${j.key}.description`)})," "]})]},j.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:[s("connection.message")," (",s("common.optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{size:18,className:"absolute left-3 top-3 text-silver-500"})," ",e.jsx("textarea",{value:x,onChange:j=>m(j.target.value),className:"w-full pl-10 pr-4 py-3 bg-white border border-sandstone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200 resize-none",rows:3,placeholder:s("connection.messagePlaceholder"),maxLength:500})]}),e.jsxs("p",{className:"text-xs text-silver-500 mt-1",children:[" ",x.length,"/500 ",s("connection.characters")]})]}),e.jsxs("div",{className:"bg-burnt-sienna/10 rounded-lg p-4",children:[" ",e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(V,{size:18,className:"text-burnt-sienna flex-shrink-0 mt-0.5"})," ",e.jsxs("div",{className:"text-sm text-burnt-sienna",children:[" ",e.jsx("div",{className:"font-medium mb-1",children:s("connection.privacyNotice.title")}),e.jsxs("ul",{className:"space-y-1 text-burnt-sienna",children:[" ",e.jsxs("li",{children:["• ",s("connection.privacyNotice.contactSharing")]}),e.jsxs("li",{children:["• ",s("connection.privacyNotice.canDecline")]}),e.jsxs("li",{children:["• ",s("connection.privacyNotice.respectDecision")]})]})]})]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-sandstone-300 bg-white rounded-b-xl",children:e.jsx("button",{type:"submit",form:"connect-request-form",disabled:P||!u||!Z,className:"w-full bg-burnt-sienna text-pure-white py-4 px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:P?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:18,className:"animate-spin"}),e.jsx("span",{children:s("connection.sendingRequest")})]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:18}),e.jsx("span",{children:s("connection.sendRequest")})]})})})]})})}function $e({currentUserId:t,otherUserId:n,otherUserName:c,onClose:o}){const{t:a}=_(),[s,u]=l.useState([]),[r,x]=l.useState(""),[m,P]=l.useState(!0),[q,N]=l.useState(!1),[y,b]=l.useState(null),[k,L]=l.useState(null),j=l.useRef(null),w=l.useRef(null);l.useEffect(()=>{p()},[t,n]);const S=()=>{var d;(d=j.current)==null||d.scrollIntoView({behavior:"smooth"})},p=async()=>{try{let d=k;if(!d){const{data:v,error:C}=await A.from("messages").select("conversation_id").or(`and(sender_id.eq.${t},receiver_id.eq.${n}),and(sender_id.eq.${n},receiver_id.eq.${t})`).limit(1).single();if(C&&C.code!=="PGRST116"){console.error("Error finding existing conversation:",C),b(a("chat.errorLoadingMessages")),P(!1);return}v&&(d=v.conversation_id,L(d))}if(d){const{data:v,error:C}=await A.from("conversation_messages").select("*").eq("conversation_id",d).order("created_at",{ascending:!0});C?(console.error("Error loading messages:",C),b(a("chat.errorLoadingMessages"))):(u(v||[]),v&&v.length>0&&v.filter(D=>D.receiver_id===t&&!D.is_read).length>0&&await A.from("messages").update({is_read:!0}).eq("conversation_id",d).eq("receiver_id",t).eq("is_read",!1))}else u([])}catch(d){console.error("Error loading messages:",d),b(a("chat.unexpectedErrorLoadingMessages"))}finally{P(!1)}},K=async()=>{if(!(!r.trim()||!k||!Z||q)){N(!0),b(null);try{const d={sender_id:t,receiver_id:n,content:r.trim()};k&&(d.conversation_id=k);const{data:v,error:C}=await A.from("messages").insert([d]).select().single();C?console.error("Error sending message:",C):(p(),x(""))}catch(d){console.error("Unerwarteter Fehler beim Senden der Nachricht:",d),b(a("chat.unexpectedErrorSendingMessage"))}finally{N(!1)}}},O=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),K())};return l.useEffect(()=>{if(!k||!Z)return;const d=A.channel(`messages:${k}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${k}`},async v=>{const C=v.new,{data:$}=await A.from("conversation_messages").select("*").eq("id",C.id).single();$&&(u(D=>[...D,$]),$.receiver_id===t&&await A.from("messages").update({is_read:!0}).eq("id",$.id))}).subscribe();return()=>{d.unsubscribe()}},[k,t,Z,a]),l.useEffect(()=>{S()},[s]),l.useEffect(()=>{w.current&&w.current.focus()},[]),e.jsx("div",{className:"fixed inset-0 bg-charcoal/60 backdrop-blur-md z-[60] flex items-center justify-center p-0 sm:p-4",children:e.jsxs("div",{className:"bg-akaroa-50 rounded-none sm:rounded-2xl w-full h-full sm:max-w-lg sm:max-h-[90vh] shadow-2xl flex flex-col overflow-hidden border-0 sm:border border-sandstone-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-rhino-900/95 to-rhino-800/95 backdrop-blur-md px-6 py-4 border-b border-rhino-700/60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-desert to-desert-700 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(W,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold font-logo text-cream text-lg",children:["Chat mit ",c]}),e.jsx("p",{className:"text-cream/70 text-sm",children:"Verbundener Kontakt"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:p,className:"p-2 hover:bg-rhino-700 rounded-lg transition-colors duration-200 active:scale-95",title:a("common.refresh"),children:e.jsx(Pe,{size:22,className:"text-cream"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-rhino-700 rounded-lg transition-colors duration-200 active:scale-95",children:e.jsx(I,{size:22,className:"text-cream"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-gradient-to-b from-akaroa-50 to-akaroa-100 min-h-0 pb-2",children:[m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-rhino to-rhino-700 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(B,{size:20,className:"animate-spin text-white"})}),e.jsx("p",{className:"text-walnut font-medium",children:"Lade Nachrichten..."})]})}):y?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3 bg-error-50 rounded-xl p-6 border border-error-200",children:[e.jsx(H,{size:32,className:"text-error-600 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-error-700 font-medium mb-2",children:y}),e.jsx("button",{onClick:()=>window.location.reload(),className:"text-desert hover:text-desert/80 underline text-sm font-medium",children:"Neu laden"})]})]})}):s.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-4 bg-cream/80 rounded-xl p-8 border border-sandstone-200 shadow-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-desert to-desert-700 rounded-full flex items-center justify-center shadow-lg mx-auto",children:e.jsx(W,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold font-logo text-rhino mb-2",children:"Noch keine Nachrichten"}),e.jsx("p",{className:"text-walnut text-sm",children:"Schreibe die erste Nachricht und beginne das Gespräch!"})]})]})}):s.map(d=>{const v=d.sender_id===t;return e.jsx("div",{className:`flex ${v?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-3 shadow-lg ${v?"bg-rhino-100 text-rhino border border-rhino-200 rounded-br-none":"bg-cream text-walnut border border-sandstone-200 rounded-bl-none"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed font-medium",children:d.content}),e.jsx("p",{className:`text-xxs mt-2 ${v?"text-rhino/70":"text-walnut/70"}`,children:X(new Date(d.created_at).toTimeString().slice(0,5))})]})},d.id)}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"bg-akaroa-100 px-4 py-4 sm:px-6 sm:py-5 pb-safe-bottom border-t border-sandstone-300 flex-shrink-0",children:[y&&e.jsx("div",{className:"mb-3 p-3 bg-error-50 border border-error-200 rounded-lg",children:e.jsx("p",{className:"text-error-700 text-sm font-medium",children:y})}),e.jsxs("div",{className:"mb-3 bg-desert/10 rounded-lg p-3 border border-desert/20",children:[e.jsx("p",{className:"text-xxs text-desert text-center leading-tight font-medium",children:"Enter zum Senden - deine Nachricht wird dann versendet,"}),e.jsx("p",{className:"text-xxs text-desert text-center leading-tight",children:"erscheint jedoch noch nicht im Chat. (kein Echtzeit Chat)"})]}),e.jsxs("div",{className:"flex space-x-3 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{ref:w,type:"text",value:r,onChange:d=>x(d.target.value),onKeyPress:O,className:"w-full px-4 py-3 bg-cream border border-sandstone-300 rounded-pill focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200 shadow-sm",placeholder:"Nachricht schreiben...",disabled:q||!k,maxLength:1e3})}),e.jsx("button",{onClick:K,disabled:!r.trim()||q||!k,className:"bg-desert text-white px-4 py-3 rounded-pill font-medium hover:bg-desert-700 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:q?e.jsx(B,{size:18,className:"animate-spin"}):e.jsx(ie,{size:18})})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("span",{className:"text-xxs text-walnut/80 font-medium",children:[r.length,"/1000 Zeichen"]})})]})]})})}function Ae({connection:t,otherUserId:n,currentUserId:c,onStartChat:o}){_();const[a,s]=l.useState("Lade...");return l.useEffect(()=>{(async()=>{try{const{data:r}=await T.getProfile(n);s((r==null?void 0:r.display_name)||(r==null?void 0:r.username)||"Unbekannter Nutzer")}catch(r){console.error("Error loading other user profile:",r),s("Unbekannter Nutzer")}})()},[n]),e.jsxs("div",{className:"bg-akaroa-100/70 rounded-lg p-4 border border-akaroa-200/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-rhino",children:a}),e.jsx("p",{className:"text-sm text-walnut",children:t.proposal_type})]}),e.jsxs("button",{onClick:()=>o(n,a),className:"bg-desert/10 text-desert py-2 px-3 rounded-lg hover:bg-desert/20 transition-colors duration-200 flex items-center space-x-1",title:"Chat starten",children:[e.jsx(W,{size:16}),e.jsx("span",{className:"text-sm",children:"Chat"})]})]})}function Le({message:t}){return e.jsxs("div",{className:"min-h-screen bg-cream flex items-center justify-center relative",children:[e.jsxs("div",{className:"fixed inset-0 z-0",children:[e.jsx("img",{src:"/topglobe copy.jpg",alt:"Werte•Kreis Background",className:"w-full h-full object-cover object-center",style:{imageRendering:"crisp-edges",filter:"contrast(1.1) brightness(1.05) saturate(1.1)",transform:"scale(1.1)",transformOrigin:"center center"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-akaroa-100/60 via-akaroa-200/60 to-akaroa-300/70"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rhino/8 via-transparent to-walnut/12"})]}),e.jsxs("div",{className:"relative z-10 text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-rhino mx-auto"}),e.jsx("p",{className:"text-rhino font-medium",children:t})]})]})}function De({message:t,onNavigateHome:n}){return e.jsxs("div",{className:"min-h-screen bg-cream flex items-center justify-center relative",children:[e.jsxs("div",{className:"fixed inset-0 z-0",children:[e.jsx("img",{src:"/topglobe copy.jpg",alt:"Werte•Kreis Background",className:"w-full h-full object-cover object-center",style:{imageRendering:"crisp-edges",filter:"contrast(1.1) brightness(1.05) saturate(1.1)",transform:"scale(1.1)",transformOrigin:"center center"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-akaroa-100/60 via-akaroa-200/60 to-akaroa-300/70"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rhino/8 via-transparent to-walnut/12"})]}),e.jsxs("div",{className:"relative z-10 text-center space-y-4",children:[e.jsx(H,{size:48,className:"text-error-600 mx-auto"}),e.jsx("h3",{className:"font-medium text-rhino",children:t}),e.jsx("button",{onClick:n,className:"bg-rhino text-white py-2 px-4 rounded-lg font-medium hover:bg-rhino-700 transition-colors duration-200",children:"Zurück zur Startseite"})]})]})}function Te(){return e.jsxs("div",{className:"fixed inset-0 z-0",children:[e.jsx("img",{src:"/topglobe copy.jpg",alt:"Werte•Kreis Background",className:"w-full h-full object-cover object-center",style:{imageRendering:"crisp-edges",filter:"contrast(1.1) brightness(1.05) saturate(1.1)",transform:"scale(1.1)",transformOrigin:"center center"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-akaroa-100/60 via-akaroa-200/60 to-akaroa-300/70"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rhino/8 via-transparent to-walnut/12"})]})}function He({isOwnProfile:t,viewingProfileId:n,isEditing:c,onNavigateHome:o,onViewProfile:a,onToggleEdit:s}){const{t:u}=_();return e.jsx("div",{className:"bg-gradient-to-r from-rhino-900/70 to-rhino-800/70 backdrop-blur-[15px] shadow-glass-nav border-b border-rhino-700/50 relative z-10",children:e.jsx("div",{className:"max-w-md mx-auto px-6 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[n&&e.jsx("button",{onClick:()=>a(null),className:"p-2 hover:bg-rhino-700/80 backdrop-blur-[5px] rounded-lg transition-all duration-200 active:scale-95 shadow-glass-button-sm",title:"Zurück zu meinem Profil",children:e.jsx(ze,{size:20,className:"text-cream"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-rhino-700/80 backdrop-blur-[5px] rounded-lg transition-all duration-200 active:scale-95 lg:flex hidden shadow-glass-button-sm",title:u("common.backToHome"),children:e.jsx(oe,{size:20,className:"text-cream"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{size:24,className:"text-cream"}),e.jsx("h1",{className:"text-2xl font-medium font-logo text-cream tracking-wide",children:u(t?"profile.myProfile":"profile.userProfile")})]})]}),t&&e.jsx("button",{onClick:s,className:"p-2 rounded-lg transition-all duration-200 backdrop-blur-[5px] shadow-glass-button-sm hover:shadow-glass-button bg-white/15 text-white hover:bg-white/25 active:scale-95",children:c?e.jsx(I,{size:24}):e.jsx(Y,{size:24})})]})})})}function Oe({message:t}){return t?e.jsxs("div",{className:`rounded-lg p-4 flex items-center space-x-3 backdrop-blur-[5px] ${t.type==="success"?"bg-success-50/80 text-success-700 border border-success-200/70":t.type==="error"?"bg-error-50/80 text-error-700 border border-error-200/70":"bg-desert-50/80 text-desert-700 border border-desert-200/70"}`,children:[t.type==="success"&&e.jsx(ae,{size:20,className:"text-success-600"}),t.type==="error"&&e.jsx(H,{size:20,className:"text-error-600"}),t.type==="info"&&e.jsx(H,{size:20,className:"text-desert-600"}),e.jsx("span",{className:"text-sm font-medium text-rhino",children:t.text})]}):null}function Ue(){return _(),null}function Ve({editForm:t,setEditForm:n,onSave:c,onCancel:o,isSaving:a}){const{t:s,i18n:u}=_();return e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(Y,{size:20,className:"text-rhino"}),e.jsx("h3",{className:"font-medium font-logo text-rhino",children:s("profile.editProfile")})]}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-walnut mb-2",children:[s("profile.displayName")," *"]}),e.jsx("input",{type:"text",value:t.display_name,onChange:r=>n(x=>({...x,display_name:r.target.value})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200",placeholder:s("profile.displayNamePlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.bio")}),e.jsx("textarea",{value:R(t.bio,u.language),onChange:r=>n(x=>({...x,bio:{...x.bio,[u.language]:r.target.value}})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200 resize-none",rows:4,placeholder:s("profile.bioPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.contribution")}),e.jsx("div",{className:"bg-desert/10 rounded-lg p-3 mb-3 border border-desert/20",children:e.jsx("p",{className:"text-sm text-desert",children:s("profile.contributionHelper")})}),e.jsx("textarea",{value:R(t.contribution,u.language),onChange:r=>n(x=>({...x,contribution:{...x.contribution,[u.language]:r.target.value}})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200 resize-none",rows:3,placeholder:s("profile.contributionPlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.city")}),e.jsx("input",{type:"text",value:t.location_city,onChange:r=>n(x=>({...x,location_city:r.target.value})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200",placeholder:s("profile.cityPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.country")}),e.jsx("input",{type:"text",value:t.location_country,onChange:r=>n(x=>({...x,location_country:r.target.value})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200",placeholder:s("profile.countryPlaceholder")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.interests")}),e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto",children:_e.map(r=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-akaroa-100/70 rounded-lg border border-akaroa-200/50 hover:bg-akaroa-100/80 transition-colors duration-200",children:[e.jsx("input",{type:"checkbox",checked:t.interests.includes(r),onChange:x=>{x.target.checked?n(m=>({...m,interests:[...m.interests,r]})):n(m=>({...m,interests:m.interests.filter(P=>P!==r)}))},className:"w-4 h-4 text-rhino border-sandstone-300 rounded focus:ring-rhino"}),e.jsx("span",{className:"text-sm text-walnut",children:s(r)})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-walnut mb-2",children:s("profile.privacyLevel")}),e.jsxs("select",{value:t.privacy_level,onChange:r=>n(x=>({...x,privacy_level:r.target.value})),className:"w-full px-4 py-3 bg-cream/80 backdrop-blur-[5px] border border-sandstone-300/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-rhino focus:border-transparent transition-all duration-200",children:[e.jsx("option",{value:"public",children:s("profile.privacy.public")}),e.jsx("option",{value:"friends",children:s("profile.privacy.friends")}),e.jsx("option",{value:"private",children:s("profile.privacy.private")})]}),e.jsxs("p",{className:"text-xs text-walnut mt-1",children:[t.privacy_level==="public"&&s("profile.privacyHelp.public"),t.privacy_level==="friends"&&s("profile.privacyHelp.friends"),t.privacy_level==="private"&&s("profile.privacyHelp.private")]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-akaroa-100/70 rounded-lg border border-akaroa-200/50",children:[e.jsx("input",{type:"checkbox",id:"email_notifications",checked:t.email_notifications,onChange:r=>n(x=>({...x,email_notifications:r.target.checked})),className:"w-4 h-4 text-rhino border-sandstone-300 rounded focus:ring-rhino"}),e.jsx("label",{htmlFor:"email_notifications",className:"text-sm text-walnut",children:s("profile.emailNotifications")})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 bg-walnut/10 text-walnut py-3 px-6 rounded-lg font-medium hover:bg-walnut/20 transition-colors duration-200",children:s("common.cancel")}),e.jsx("button",{type:"submit",disabled:a,className:"flex-1 bg-rhino/70 backdrop-blur-[8px] text-cream py-3 px-6 rounded-lg font-medium shadow-glass-button hover:shadow-glass-button-hover transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 border border-rhino-700/50 hover:border-rhino-700/60 transform hover:scale-[1.02] disabled:transform-none",children:a?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:18,className:"animate-spin"}),e.jsx("span",{children:s("common.saving")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{size:18}),e.jsx("span",{children:s("common.save")})]})})]})]})]})}function Be({profile:t,user:n,isOwnProfile:c,isConnected:o,onShowConnectModal:a,onShowChatWindow:s}){const{t:u,i18n:r}=_();return e.jsx("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-desert to-desert-700 rounded-full flex items-center justify-center shadow-lg mx-auto",children:e.jsx(se,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold font-logo text-rhino",children:t.display_name||t.username||u("common.unknown")}),t.location_city&&e.jsxs("p",{className:"text-walnut mt-1 flex items-center justify-center space-x-1",children:[e.jsx(Ne,{size:16}),e.jsx("span",{children:[t.location_city,t.location_country].filter(Boolean).join(", ")})]})]}),!c&&n&&e.jsx("div",{className:"flex space-x-3 justify-center",children:o?e.jsxs("button",{onClick:s,className:"bg-success-50 text-success-700 py-2 px-4 rounded-lg font-medium hover:bg-success-100 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx(W,{size:16}),e.jsx("span",{children:u("discover.startChat")})]}):e.jsxs("button",{onClick:a,className:"bg-desert/70 backdrop-blur-[8px] text-white py-2 px-4 rounded-lg font-medium shadow-glass-button hover:shadow-glass-button-hover transition-all duration-200 flex items-center space-x-2 border border-desert-600/50",children:[e.jsx(V,{size:16}),e.jsx("span",{children:u("discover.sendRequest")})]})})]})})}function We({profile:t}){const{t:n,i18n:c}=_();return e.jsxs(e.Fragment,{children:[t.bio&&R(t.bio,c.language).trim()&&e.jsxs("div",{className:"bg-akaroa-100/70 backdrop-blur-[10px] rounded-lg p-4 border border-sandstone-300/50 shadow-glass-card",children:[e.jsx("h4",{className:"font-medium font-logo text-rhino mb-2",children:n("profile.aboutMe")}),e.jsx("p",{className:"text-walnut leading-relaxed",children:R(t.bio,c.language)})]}),t.contribution&&R(t.contribution,c.language).trim()&&e.jsxs("div",{className:"bg-akaroa-100/70 backdrop-blur-[10px] rounded-lg p-4 border border-sandstone-300/50 shadow-glass-card",children:[e.jsx("h4",{className:"font-medium font-logo text-rhino mb-2",children:n("profile.myContribution")}),e.jsx("p",{className:"text-walnut leading-relaxed",children:R(t.contribution,c.language)})]}),t.interests&&t.interests.length>0&&e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsx("h4",{className:"font-medium font-logo text-rhino mb-3",children:n("profile.interests")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.interests.filter(Ce).map(o=>e.jsx("span",{className:"bg-akaroa-200 text-rhino px-3 py-1 rounded-full text-sm font-medium",children:n(o)},o))})]})]})}function Ke({incomingRequests:t,onAcceptRequest:n,onRejectRequest:c}){const{t:o}=_();return t.length===0?null:e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsxs("h4",{className:"font-medium font-logo text-rhino mb-4 flex items-center space-x-2",children:[e.jsx(V,{size:18}),e.jsx("span",{children:o("profile.connectionRequests")})]}),e.jsx("div",{className:"space-y-3",children:t.map(a=>{var s,u;return e.jsxs("div",{className:"bg-akaroa-100/70 rounded-lg p-4 border border-akaroa-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-rhino",children:((s=a.sender_profile)==null?void 0:s.display_name)||((u=a.sender_profile)==null?void 0:u.username)||o("common.unknown")}),e.jsx("span",{className:"text-xs bg-desert/20 text-desert px-2 py-1 rounded",children:a.proposal_type})]}),a.message&&e.jsxs("p",{className:"text-sm text-walnut mb-3 italic",children:['"',a.message,'"']}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(a.id),className:"flex-1 bg-success-50 text-success-700 py-2 px-3 rounded-lg font-medium hover:bg-success-100 transition-colors duration-200 text-sm",children:o("profile.accept")}),e.jsx("button",{onClick:()=>c(a.id),className:"flex-1 bg-error-50 text-error-700 py-2 px-3 rounded-lg font-medium hover:bg-error-100 transition-colors duration-200 text-sm",children:o("profile.reject")})]})]},a.id)})})]})}function Ge({connections:t,user:n,onStartChat:c}){const{t:o}=_();return t.length===0?null:e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsxs("h4",{className:"font-medium font-logo text-rhino mb-4 flex items-center space-x-2",children:[e.jsx(te,{size:18}),e.jsx("span",{children:o("profile.myConnections")})]}),e.jsxs("div",{className:"space-y-3",children:[t.slice(0,5).map(a=>{const s=a.sender_id===n.id?a.receiver_id:a.sender_id;return e.jsx(Ae,{connection:a,otherUserId:s,currentUserId:n.id,onStartChat:c},a.id)}),t.length>5&&e.jsx("p",{className:"text-sm text-walnut text-center",children:o("profile.andMoreConnections",{count:t.length-5})})]})]})}function Ze({createdEvents:t,onNavigateToEvents:n}){const{t:c,i18n:o}=_();return t.length===0?null:e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsxs("h4",{className:"font-medium font-logo text-rhino mb-4 flex items-center space-x-2",children:[e.jsx(re,{size:18}),e.jsx("span",{children:c("profile.myEvents")})]}),e.jsxs("div",{className:"space-y-3",children:[t.slice(0,3).map(a=>e.jsxs("div",{className:"bg-akaroa-100/70 rounded-lg p-4 border border-akaroa-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-rhino",children:R(a.title,o.language)}),e.jsx("div",{className:"flex space-x-1",children:e.jsx("button",{onClick:n,className:"bg-desert/10 text-desert p-1 rounded hover:bg-desert/20 transition-colors duration-200",children:e.jsx(Y,{size:14})})})]}),e.jsxs("p",{className:"text-sm text-walnut",children:[ne(a.event_date)," • ",X(a.event_time)]}),e.jsx("p",{className:"text-sm text-walnut mt-1",children:R(a.location,o.language)}),a.rsvp_count&&a.rsvp_count[0]&&e.jsxs("p",{className:"text-xs text-success-700 mt-2 flex items-center space-x-1",children:[e.jsx(te,{size:12}),e.jsxs("span",{children:[a.rsvp_count[0].count," ",c("events.peopleAttending")]})]})]},a.id)),t.length>3&&e.jsx("p",{className:"text-sm text-walnut text-center",children:c("profile.andMoreEvents",{count:t.length-3})})]})]})}function Ie({rsvpEvents:t}){const{t:n,i18n:c}=_();return t.length===0?null:e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50",children:[e.jsxs("h4",{className:"font-medium font-logo text-rhino mb-4 flex items-center space-x-2",children:[e.jsx(re,{size:18}),e.jsx("span",{children:n("profile.myRSVPs")})]}),e.jsxs("div",{className:"space-y-3",children:[t.slice(0,3).map(o=>{var a,s,u,r;return e.jsxs("div",{className:"bg-akaroa-100/70 rounded-lg p-4 border border-akaroa-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-rhino",children:R((a=o.event)==null?void 0:a.title,c.language)}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${o.status==="attending"?"bg-success-50 text-success-700":o.status==="maybe"?"bg-warning-50 text-warning-700":"bg-error-50 text-error-700"}`,children:o.status==="attending"?n("events.attend"):o.status==="maybe"?n("events.maybe"):n("events.notAttending")})]}),e.jsxs("p",{className:"text-sm text-walnut",children:[ne((s=o.event)==null?void 0:s.event_date)," • ",X((u=o.event)==null?void 0:u.event_time)]}),e.jsx("p",{className:"text-sm text-walnut mt-1",children:R((r=o.event)==null?void 0:r.location,c.language)})]},o.id)}),t.length>3&&e.jsx("p",{className:"text-sm text-walnut text-center",children:n("profile.andMoreRSVPs",{count:t.length-3})})]})]})}function Fe({onSignOut:t,onDeleteAccount:n,isDeleting:c}){const{t:o}=_();return e.jsxs("div",{className:"bg-cream/70 backdrop-blur-[15px] rounded-xl p-6 shadow-glass-card border border-sandstone-300/50 space-y-4",children:[e.jsx("h4",{className:"font-medium font-logo text-rhino mb-4",children:o("profile.accountActions")}),e.jsxs("button",{onClick:t,className:"w-full bg-walnut/70 backdrop-blur-[8px] text-white py-3 px-6 rounded-lg font-medium shadow-glass-button hover:shadow-glass-button-hover transition-all duration-200 border border-walnut-700/50 flex items-center justify-center space-x-2",children:[e.jsx(Re,{size:18}),e.jsx("span",{children:o("profile.signOut")})]}),e.jsx("p",{className:"text-xs text-walnut leading-relaxed",children:o("profile.deleteAccountInfo")}),e.jsx("button",{onClick:n,disabled:c,className:"w-full bg-sandstone-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-sandstone-600 transition-colors duration-200 text-sm flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:16,className:"animate-spin"}),e.jsx("span",{children:o("profile.deleting")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:o("profile.deleteAccount")})]})})]})}function cs({onNavigate:t,onSignOut:n,viewingProfileId:c,onViewProfile:o,connectedUserIds:a}){const{t:s,i18n:u}=_(),[r,x]=l.useState(null),[m,P]=l.useState(null),[q,N]=l.useState(!0),[y,b]=l.useState(!1),[k,L]=l.useState(!1),[j,w]=l.useState(!1),[S,p]=l.useState(null),[K,O]=l.useState(!1),[d,v]=l.useState(!1),[C,$]=l.useState([]),[D,F]=l.useState([]),[Je,le]=l.useState([]),[ce,de]=l.useState([]),[ue,xe]=l.useState([]),[M,J]=l.useState({display_name:"",bio:{de:"",en:"",fr:""},contribution:{de:"",en:"",fr:""},interests:[],location_city:"",location_country:"",privacy_level:"public",email_notifications:!0}),G=m&&r&&m.id===r.id,me=r&&a.includes(r.id);l.useEffect(()=>{if(S){const f=setTimeout(()=>p(null),5e3);return()=>clearTimeout(f)}},[S]);const he=async f=>{var h,z,U,ee;const i={id:f.id,username:((h=f.user_metadata)==null?void 0:h.username)||((z=f.email)==null?void 0:z.split("@")[0])||"",display_name:((U=f.user_metadata)==null?void 0:U.display_name)||((ee=f.user_metadata)==null?void 0:ee.username)||"",bio:{de:"",en:"",fr:""},contribution:{de:"",en:"",fr:""},interests:[],location_city:"",location_country:"",privacy_level:"public",email_notifications:!0,data_processing_consent:!1},{error:g}=await T.createProfile(i);return g?(console.error("Error creating profile:",g),p({type:"error",text:`${s("errors.unexpectedError")}: ${g.message}`}),null):(console.log("Profile created successfully"),x(i),J({display_name:i.display_name,bio:i.bio,contribution:i.contribution,interests:i.interests,location_city:i.location_city,location_country:i.location_country,privacy_level:i.privacy_level,email_notifications:i.email_notifications}),b(!0),p({type:"success",text:"Profil erstellt! Bitte vervollständige deine Angaben."}),i)},pe=async f=>{try{const[i,g,h,z,U]=await Promise.allSettled([E.getIncomingRequests(f),E.getOutgoingRequests(f),E.getAcceptedConnections(f),we.getUserEvents(f),ke.getUserRSVPs(f)]);i.status==="fulfilled"&&F(i.value.data||[]),g.status==="fulfilled"&&le(g.value.data||[]),h.status==="fulfilled"&&$(h.value.data||[]),z.status==="fulfilled"&&de(z.value.data||[]),U.status==="fulfilled"&&xe(U.value.data||[])}catch(i){console.error("Error loading additional data:",i)}};l.useEffect(()=>{(async()=>{N(!0);try{const{data:i}=await ye.getCurrentUser();if(!i.user){p({type:"error",text:s("errors.noUserFound")}),N(!1);return}P(i.user);const g=c||i.user.id;if(!g){p({type:"error",text:s("errors.noUserFound")}),N(!1);return}const{data:h,error:z}=await T.getProfile(g);z?(console.error("Error loading profile:",z),z.code==="PGRST116"&&i.user&&g===i.user.id?(console.log("Profile not found, creating new profile for user:",i.user.id),await he(i.user)):p({type:"error",text:`${s("errors.unexpectedError")}: ${z.message}`})):h&&(x(h),J({display_name:h.display_name||"",bio:typeof h.bio=="object"?h.bio:{de:h.bio||"",en:"",fr:""},contribution:typeof h.contribution=="object"?h.contribution:{de:h.contribution||"",en:"",fr:""},interests:h.interests||[],location_city:h.location_city||"",location_country:h.location_country||"",privacy_level:h.privacy_level||"public",email_notifications:h.email_notifications!==!1})),i.user&&g===i.user.id&&await pe(g)}catch(i){console.error("Error loading user data:",i),p({type:"error",text:s("errors.unexpectedError")})}finally{N(!1)}})()},[c,a,s]);const fe=async f=>{if(f.preventDefault(),!(!m||!r)){L(!0),p(null);try{const i={display_name:M.display_name,bio:M.bio,contribution:M.contribution,interests:M.interests,location_city:M.location_city,location_country:M.location_country,privacy_level:M.privacy_level,email_notifications:M.email_notifications},{error:g}=await T.updateProfile(m.id,i);if(g)console.error("Error updating profile:",g),p({type:"error",text:`${s("errors.unexpectedError")}: ${g.message}`});else{p({type:"success",text:s("profile.profileUpdated")}),b(!1);const{data:h}=await T.getProfile(m.id);h&&x(h)}}catch(i){console.error("Error saving profile:",i),p({type:"error",text:s("errors.unexpectedError")})}finally{L(!1)}}},be=async()=>{if(!(!m||!window.confirm(s("profile.confirmDelete")))){w(!0);try{await T.deleteProfile(m.id),p({type:"success",text:s("profile.accountDeleted")}),setTimeout(()=>{n()},2e3)}catch(f){console.error("Error deleting account:",f),p({type:"error",text:s("errors.unexpectedError")})}finally{w(!1)}}},ge=async f=>{try{const{error:i}=await E.updateRequestStatus(f,"accepted");if(i)p({type:"error",text:`${s("errors.unexpectedError")}: ${i.message}`});else if(p({type:"success",text:s("profile.connectionAccepted")}),m){const{data:g}=await E.getIncomingRequests(m.id);F(g||[]);const{data:h}=await E.getAcceptedConnections(m.id);$(h||[])}}catch(i){console.error("Error accepting request:",i),p({type:"error",text:s("errors.unexpectedError")})}},je=async f=>{try{const{error:i}=await E.updateRequestStatus(f,"rejected");if(i)p({type:"error",text:`${s("errors.unexpectedError")}: ${i.message}`});else if(p({type:"success",text:s("profile.connectionRejected")}),m){const{data:g}=await E.getIncomingRequests(m.id);F(g||[])}}catch(i){console.error("Error rejecting request:",i),p({type:"error",text:s("errors.unexpectedError")})}},ve=(f,i)=>{o(f),v(!0)};return q?e.jsx(Le,{message:s("common.loading")}):r?e.jsxs("div",{className:"min-h-screen bg-cream relative",children:[e.jsx(Te,{}),e.jsx(He,{isOwnProfile:!!G,viewingProfileId:c,isEditing:y,onNavigateHome:()=>t("home"),onViewProfile:o,onToggleEdit:()=>b(!y)}),e.jsxs("div",{className:"max-w-md lg:max-w-3xl mx-auto px-3 py-6 pb-24 md:px-6 space-y-6 relative z-10",children:[e.jsx("div",{className:"lg:flex hidden",children:e.jsxs("button",{onClick:()=>t("home"),className:"bg-akaroa-100/70 backdrop-blur-[8px] text-rhino hover:bg-akaroa-200/80 rounded-lg transition-all duration-200 p-2 flex items-center space-x-2 shadow-glass-button hover:shadow-glass-button-hover border border-sandstone-300/50 hover:border-sandstone-300/60 transform hover:scale-[1.02]",title:s("common.backToHome"),children:[e.jsx(oe,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:s("common.home")})]})}),e.jsx(Oe,{message:S}),e.jsx(Ue,{}),y&&G?e.jsx(Ve,{editForm:M,setEditForm:J,onSave:fe,onCancel:()=>b(!1),isSaving:k}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Be,{profile:r,user:m,isOwnProfile:!!G,isConnected:!!me,onShowConnectModal:()=>O(!0),onShowChatWindow:()=>v(!0)}),e.jsx(We,{profile:r}),G&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{incomingRequests:D,onAcceptRequest:ge,onRejectRequest:je}),e.jsx(Ge,{connections:C,user:m,onStartChat:ve}),e.jsx(Ze,{createdEvents:ce,onNavigateToEvents:()=>t("events")}),e.jsx(Ie,{rsvpEvents:ue}),e.jsx(Fe,{onSignOut:n,onDeleteAccount:be,isDeleting:j})]})]})]}),K&&r&&m&&e.jsx(Me,{receiverProfileId:r.id,receiverName:r.display_name||r.username||s("common.unknown"),currentUserId:m.id,onClose:()=>O(!1),onSendSuccess:()=>{O(!1),p({type:"success",text:s("connection.requestSent")})}}),d&&m&&r&&e.jsx($e,{currentUserId:m.id,otherUserId:c||r.id,otherUserName:r.display_name||r.username||"Unbekannter Nutzer",onClose:()=>v(!1)})]}):e.jsx(De,{message:s("profile.profileNotFound"),onNavigateHome:()=>t("home")})}export{cs as default};
